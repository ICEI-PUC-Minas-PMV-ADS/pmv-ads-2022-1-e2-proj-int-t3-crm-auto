@using CRM_Auto.Models
@using CRM_Auto.ViewModels
@model OficinaOrdemServicoViewModel

@{
    Layout = "../Shared/_Layout_Cadastro_Veiculo.cshtml";
}

@section LinkCss
{
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/css/menu.css">
    <link rel="stylesheet" href="~/css/cad-cliente.css">
    <link rel="stylesheet" href="~/css/cadastros.css">
}


    <header class="header" id="header">
        <div class="header_toggle">
            <i class='bx bx-menu' id="header-toggle"></i>
        </div>
        <div id="header_user" class="header_img">
            <button id="dropdownMenuButton" type="button" class="btn btn-secondary btn-user dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="26" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 22">
                <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>
                <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"></path>
                </svg>
            </button>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="#">Perfil</a>
                <a class="dropdown-item" href="#">Configurações</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Sair</a>
            </div>
        </div>
    </header>
    <div class="l-navbar" id="nav-bar"> <!-- Início menu lateral -->
        <nav class="nav">
            <div> 
                <a href="#" class="nav_logo">
                    <i class='bx bx-layer nav_logo-icon'></i> 
                    <span class="nav_logo-name">CRMAuto</span> 
                </a>
                <div class="nav_list">
                    <a href="#" class="nav_link active"> 
                        <i class='bx bx-grid-alt nav_icon' data-bs-toggle="tooltip" title="Painel"></i> 
                        <span class="nav_name">Painel</span> 
                    </a>
                    <a href="#" class="nav_link">
                        <i class='bx bx-message-square-detail nav_icon' data-bs-toggle="tooltip" title="Ordens de serviços"></i>
                        <span class="nav_name">Ordens de serviços</span>
                    </a>
                    <a href="#" class="nav_link">
                        <i class='bx bx-bookmark nav_icon' data-bs-toggle="tooltip" title="Orçamentos"></i>
                        <span class="nav_name">Orçamentos</span>
                    </a>
                    <a href="#" class="nav_link">
                        <i class='bi bi-people nav_icon' data-bs-toggle="tooltip" title="Clientes"></i>
                        <span class="nav_name">Clientes</span>
                    </a>
                    <a href="#" class="nav_link">
                        <i class="bi bi-wrench-adjustable nav_icon" data-bs-toggle="tooltip" title="Oficina"></i>
                        <span class="nav_name">Oficina</span>
                    </a>
                    <a href="#" class="nav_link">
                        <i class='bi bi-person-video2 nav_icon' data-bs-toggle="tooltip" title="Funcionários"></i>
                        <span class="nav_name">Funcionários</span>
                    </a>
                    <a href="#" class="nav_link">
                        <i class='bx bx-bar-chart-alt-2 nav_icon' data-bs-toggle="tooltip" title="Relatórios"></i>
                        <span class="nav_name">Relatórios</span>
                    </a>
                    <a href="#" class="nav_link">
                        <i class='bx bx-user nav_icon' data-bs-toggle="tooltip" title="Usuários"></i>
                        <span class="nav_name">Usuários</span>
                    </a>
                </div>
            </div>
            <a href="Homepage.html" class="nav_link">
                <i class='bx bx-log-out nav_icon' data-bs-toggle="tooltip" title="Sair"></i>
                <span class="nav_name">Sair</span>
            </a>
        </nav>
    </div>  <!-- Fim menu lateral -->
    
<!-- SÓ TRABALHAR DAQUI PARA BAIXO...  -->

    <div class="height-100"> <!--Container Main start-->
        <form asp-controller="GerarOS">
            <h3>Ordem de serviços/Adicionar Serviços</h3>
            <div class="row">
                <div class="form-group col-sm-4">
                    <label asp-for="OrdemServico.CpfCnpj">CPF do Cliente (*)</label>
                    <input type="text" class="form-control" asp-for="OrdemServico.CpfCnpj" required placeholder="Informe a Cliente" onchange="BuscaPlacas(this)">
                </div>
    
                <div class="form-group col-sm-4">
                    <label asp-for="OrdemServico.PlacaVeiculo">Placa do Veículo (*)</label>
                    <select asp-for="OrdemServico.PlacaVeiculo" id="placaCliente" class="form-control">

                    </select>
                </div>
                
                <div class="form-group col-sm-2">
                    <label asp-for="OrdemServico.DataOrdem">Data da ordem de Serviço</label>
                    <input type="text" class="form-control" asp-for="OrdemServico.DataOrdem" value="@DateTime.Now" disabled placeholder="@DateTime.Now">
                </div>
            </div>
            
            
            <div class="row ">
                <div class="form-group col-sm-2">
                    <label asp-for="OrdemServico.Telefone">Telefone/contato (*)</label>
                    <input type="text" class="form-control" asp-for="OrdemServico.Telefone" required placeholder="Informe o telefone">
                </div>

                <div class="form-group col-sm-4">
                    <label asp-for="OrdemServico.Email">E-mail (*)</label>
                    <input type="text" class="form-control" asp-for="OrdemServico.Email" required placeholder="Informe o E-mail">
                </div>

                @*<div class="form-group col-sm-2">
                    <label for="inputAgendamento">Agendamento (*)</label>
                    <input type="text" class="form-control" id="inputAgendamento" required placeholder="Informe Agendamento">
                </div>*@ 
            </div>

            
            <div class="row form-group">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="tb-desc-servico" scope="col">Descrição do Serviço</th>
                            <th class="tb-mecanico" scope="col">Mecânico responsável</th>
                            <th class="tb-dt-inicial" scope="col">Hora inicial</th>
                            <th class="tb-dt-final" scope="col">Hora final</th>
                            <th class="tb-vlr-servico" scope="col">Valor do Serviço (un.)</th>
                            <th class="tb-check" scope="col">Aprovado</th>
                            <th class="tb-qtde" scope="col">Qtde</th>
                            <th class="tb-btn" scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <select asp-for="Servico.Descricao" class="form-control" asp-items="@ViewBag.ListaServicos" onchange="BuscarPreco(this)">
                                    <option selected>Selecione um serviço...</option>
                                </select>
                            </td>
                            <td>
                                <select asp-for="Servico.IdMecanicoResponsavel" class="form-control">
                                    <option>Selecionar</option>
                                @foreach (MecanicoModel mecanico in ViewBag.ListaMecanicos)
                                {
                                    <option value="@mecanico.IdMecanico">@mecanico.Nome</option>
                                }
                            </select>
                            </td>
                            <td><input asp-for="Servico.InicioServico"></td>
                            <td><input asp-for="Servico.FimServico"></td>
                            <td><select id="PrecoServico" class="form-control">
                                <option>Selecione</option>
                            </select></td>
                            <td><input asp-for="Servico.ServicoAprovado"></td>
                            <td><input asp-for="Servico.Quantidade" class="form-control"/></td>
                            
                        </tr>
                        
                    </tbody>
                </table>
            </div>


            <!-- <div class="row">
                <div class="col-sm-12">
                    <table id="grid-contatos" class="table table-striped">
                        <thead>
                            <tr>
                                
                                    
                                </td>
                            </tr>
                            
                        </thead>
                        <tbody id="table-contatos"> -->
                           
                                    <!-- <td>
                                        <button class="btn btn-primary">Ver</button>
                                    </td> -->
                                <!-- </tr>
                                <tr>
                                    
                                </tr>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div> -->
            <input type="submit" value="Salvar Ordem de Serviço" class="btn btn-success"/>
            
        </form>
        <small>(*) Campos obrigatórios</small>
    </div> <!-- Fim div CONTAINER -->


    <script>

    function BuscaPlacas(e){
        document.getElementById('placaCliente').options.length = 0;
        console.log(e.value)
        $.post("BuscarPlacas", {Cnpj_cpf: e.value}, function(result,status,xhr) {
            console.log(`data: ${result}, status: ${status}`);
            if (status === 'success') {
                const options = $("#placaCliente");
                options.innerHTML = "";
                for (let i = 0; i < result.length; i++) {
                    const item = result[i];
                    console.log(item)
                    options.append('<option value="' +item + '">' + item + '</option>');
                }
            }
        })
    }

    function BuscarPreco(e){
        document.getElementById('PrecoServico').options.length = 0;
        console.log(e.value)
        $.post("BuscarPreco", {Descricao: e.value}, function(result,status,xhr) {
            console.log(`data: ${result}, status: ${status}`);
            if (status === 'success') {
                const displayValor = $("#PrecoServico");
                displayValor.innerHTML = "";
                displayValor.append('<option value="' +result + '">' + result + '</option>');
            }
        })
    }

</script>